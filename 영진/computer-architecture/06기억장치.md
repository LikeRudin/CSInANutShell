# 06 기억장치

# CONTENTS
```
        - 1. 기억장치 개요

            - A. 참조 지역성
                -  시간적 지역성
                -  공간적 지역성
                -  지역성고려의 장점, 단점
            
            - B. 기억장치 계층구조

            - C. 히트와 미스
            
            - D. 성능평가 요인


        - 2. 주기억장치

            - A. 기억장치모듈
            
            - B. 연관기억장치
            
            - C. 가상기억장치
                - 페이징
                - 세그먼트

            - D. 캐시기억장치
                - 특징 및 역할
                - 성능평가
                - 사상방식
                    - 직접사상
                    - 연관사상
                    - 집합-연관사상



```

# DETAILS

## 1. 기억장치 개요

기억장치 분류도
![](https://media.geeksforgeeks.org/wp-content/uploads/20210525193336/memory-660x292.jpg)

주기억장치(Primary Memory)

-  메인보드의 주 기억장치와 레지스터로 구성


보조기억장치(Secondary Memory)

- 주 기억장치의 휘발성과 작은 용량을 극복하기위한메모리.

- 고정형(fixed) 와 분리형(Removable)으로 구분하기도 함

### A. 참조 지역성(principle of locality)

프로그램의 데이터에관한 접근이 주소공간(address space)의 특정 부분에 집중되는 특성

컴퓨터 구조뿐만아니라 시스템 소프트웨어 디자인과 전체 성능에 커다란 영향을 가짐


1. 시간적 지역성(Temporal locality)
    - 하나의 데이터가 참조시, 짧은 시간안에 여러번 재참조될 가능성이 큼

<br>

2. 공간적 지역성(spatial locality)
    - 하나의 데이터가 참조시, 그 주변에있는 데이터들이 참조될 가능성이 큼

    - 명령어들은 순차적으로 접근, 큰 공간적 지역성 보유

### 지역성고려 디자인의 장점

- `cache` 친화적 코드를 작성하는데 중요한 역할

<br>

- cpu가 주 기억장치에 접근하여 데이터를 읽어오는 시간은 이미 레지스터에 저장되어있는 데이터를 읽을때보다 `100배` 이상의 시간이 필요

- 자주 읽히는 지역성이 높은 코드들을 cpu와  주기억장치 사이에 위치한 `cache`에 위치시키는것으로 성능향상을 도모

### 지역성을 고려할때의 단점

- 메모리구조와 접근패턴의 복잡성 증가

- 코드 사이즈 증가

- 디버깅이 어려움

### B. 기억장치 계층구조

![](https://media.geeksforgeeks.org/wp-content/uploads/20230609020524/Memory-Hierarchy-Design.png)

지역성의 원리를 이용하기위한 계층구조
속도와 용량에따라 구분

- 가장 `저렴한 가격`💲으로 저장장치 `접근속도를 가장높게` 하기위해 이용

<br>

높은 계층(낮은 `level`)의 일반적 특징

- cpu로부터의 데이터 `접근속도`가 빠름🚀
- `가격`이 비쌈💲
- `용량`이 작음🔻

낮은계층(높은 `level`)의 일반적 특징
- 데이터를 많이 가지고있음
- 용량이 큼

### C. 히트와 미스

![](https://cdn.discordapp.com/attachments/777768529805312040/1137583786092146819/block.png)

```
https://sangcho.tistory.com/entry/%EA%B8%B0%EC%96%B5%EC%9E%A5%EC%B9%98
```
- 두 계층간 전송 데이터 단위를 block이라 함

히트: `Hit` 💥

- 중앙처리장치가 요구하는 데이터가 상위계층 기억장치의 블록에 저장되어있음

미스: `Miss` 💤

- 중앙처리장치가 요구하는 데이터가 상위계층에 없어서 하위계층에 접근해야함

기억장치에 접근할때, 상위계층 기억장치에서 원하는 데이터를 찾는비율을 `히트율`(hit ratio), 못찾는 비율을 `미스율`(miss ratio)라 부름

### D. 기억장치의 성능평가 요인

- 기억용량 (capacity)


<br>

- 접근시간 (access time)
    - 데이터를 읽거나 기록하는데 걸리는 시간


<br>

- 사이클시간 (cycle time)
    - 기억장치 접근 시작부터 다음 접근 시작 전까지의 시간


<br>

- 기억장치의 대역폭(bandwidth)
    - 데이터 처리 속도, 데이터 전송률


<br>

- 가격 (cost)

## 2. 주기억장치 (Primary Memory)



### A. 기억장치 모듈

- 기억장치와 이에 접근하기위한 MAR 과 MBR을 묶어서 구성

- 복수 모듈 기억장치: 기억장치 모듈을 여러개 가진 기억장치

    - 모듈 수만큼 동시에 접근가능

    - 버스를 구성하는 데이터 선의 수가 많으면 모듈별 동시 병렬접근 가능


![](https://static.javatpoint.com/operating-system/images/what-is-interleaved-memory.png)



<br>

- 단일 기억장치 사용시 발생하는 문제

    - `버스경합` (bus contention): 1개의 버스를 공유하는 시스템에서 동시에 버스사용 요구시 발생

    - `기억장치충돌` (memory conflict): 1개이상의 모듈이 동일한 버스를 사용하면 데이터간 충돌

- 기억장치 인터리빙: 기억장치를 복수모듈로 구성하고 각 모듈이 동시에 접근할수 있도록 하는 방식

### B. 연관기억장치

기억장치의 주소가 아니라 기억장치가 `기억한 데이터`를 이용하여 기억장치에 접근하는 방식

별칭: 내용주소화 기억장치(`CAM`: Content Addressable Memory)
![](https://www.mdpi.com/electronics/electronics-11-00481/article_deploy/html/images/electronics-11-00481-g001.png)

### C. 가상기억장치

주기억장치의 용량 부족을 개선하기위해 보조기억장치의 일부를 주기억장치처럼 사용

실제 주기억장치에는 현재 실행되는 프로그램에 필요한 블록만 기억시키고, 나머지는 보조기억장치에 두었다가 필요시 인출

`가상주소`(VA Virtual Address): 가상기억장치 시스템의 프로그램 명령어가 사용하는 주소

`물리주소`(PA Physical Address): 실제 주기억장치에 적용하는 주소

- 장점: 주기억장치가 프로세스를 더 많이 저장케함

- 단점: 시스템 복잡도 상승, 데이터 충돌, 손실 위함 증가

### 페이징기법
가상기억공간과 실제 기억공간의 프로그램 블록 크기가 같고, 모든 블록의 크기를 모두 동일하게 나누는 기법.
    
- 이 블록을 `페이지`라 부름.

### 세그먼트기법

프로그램의 논리적인 구조에따라 페이지의 크기를 다양하게 나누는 방법 
- 서로다른 크기로 구성된 페이지들을 `세그먼트`라 함

### D. 캐시기억장치

![](https://media.geeksforgeeks.org/wp-content/uploads/cache.png)

1. 특징 및 역할

    - 아주빠른 기억소자로 구성 RAM (주 기억장치)와 CPU 사이의 메모리 버퍼 역할을 수행

    - 지역성의 원리를 통해 자주 요청되는 데이터와 명령어를 저장, cpu가 즉각적으로 사용할수 있게함

    - 주기억장치나 기타 메모리보다 비싸나, CPU내부 레지스터보다 저렴함
    
    - 캐시기억장치로 정보를 저장할떄, 요청받은 정보와 그주위 정보도 함께 저장함. (지역 접근성)

    - 접근하고자 하는 정보가 캐시에 존재시 히트, 없으면 미스 라고함

2. 캐시의 성능 평가

    - 히트율과 미스율을 이용

    |히트율(hit ratio)|hit / (hit + miss) | hit / total accesses|1 - hit ratio(H)|
    |--|--|--|--|
    |미스율(miss ratio)|miss / (hit + miss)| miss / total accesses|1 - miss ratio(H)|


3. 사상(mapping) 방식

    - 주 기억장치의 데이터를 캐시에 저장하는 방식

    - 직접사상(direct mapping)

        - 가장 간단한 테크닉
    
        - 주기억장치의 블록한개를 캐시메모리의 주소 한개에 저장
        - 캐시가 가득 차있으면 오래된 블록 삭제
        - 블록별로 저장위치가 정해져있음

            
            ![](https://media.geeksforgeeks.org/wp-content/uploads/cache1.png)
        
            ```
            캐시 저장공간 위치 = 주기억장치 블록번호 % 캐시 저장공간 수
            i = j modulo m
            
            i = 캐시 메모리 주소 개수
            j = 주기억장치 블록 번호
            m = 캐시 주소공간 수
            ```
    
            ![](https://media.geeksforgeeks.org/wp-content/uploads/20190305171558/1232.png)

        - 캐시는 메인메모리의 주소를 `Tag`와 `Index` 필드로 나누어 저장한다. (사진에선 Line-offset)

        - `Index` 필드가 일치시 `Tag` 필드의 일치여부를 확인한다.

        - `Tag`필드까지 일치하면 `Hit`: 캐시에 저장된 `Word-offset`을 cpu가 가져간다.
            
        - `Index` 필드를 찾을 수 없거나, `Tag` 마저 일치하는 필드를 찾을수없을경우 `Miss`: 캐시에 주기억장치의 데이터를 불러온다

        - `Index` 별로 하나의 데이터만 저장할 수있다.


    - 연관사상(associative mapping)
        - 연관 기억장치 사용
        
        - 주소가아니라 데이터 내용으로 접근가능
            - 일반적으로 주소와 데이터를 합쳐서 하나의 `블록`으로 저장한다.

        <br>
        
        - 메인메모리의 블록은 캐시의 아무자리에 저장가능
        
        - 가장 빠르고 가장유연하며 가장비싼방식
    
            ![](https://media.geeksforgeeks.org/wp-content/uploads/cache2.png)
    
    - 집합-연관사상(set-associative mapping)
        - 직접사상과 연관사상의 장점을 가진 사상

        - 여러개의 캐시주소를 묶은 집합을 구성

        - 하나의 `Index` 가 하나의 집합을 가르킴

        - 블록 안의 정보는 특정 집합 내부 아무곳에나 저장가능
              ![](https://media.geeksforgeeks.org/wp-content/uploads/cache4.png)
            ```
            m = v * k
            캐시 전체 주소 수 = 집합 수 * 집합내부 주소 수
            
            i = j mod v
            명렁어가 저장되는 캐시집합 번호 = 주기억장치 블록번호 % 캐시의 집합 수


            i = 캐시 집합 번호
            j = 주 기억장치 블록 번호
            v = 집합의 개수
            m = 캐시의 전체 주소 수
            k = 집합이 가진 캐시 주소 수
            ```

            ![](https://media.geeksforgeeks.org/wp-content/uploads/20190305171821/setassociative.png)

            - 중앙처리장치 주소의 `Index`와 같은 값을 갖는 `집합`을 찾는다.: 직접사상방식과 유사

            - 집합내부에서 연관사상방식과 같은 방식으로 데이터를 찾는다.
      

# QUESTION

가상 기억장치와 캐시의 차이점을 설명하시오

# ANSWER

|항목|가상기억장치|캐시|
|--|--|--|
|목적|주기억장치 메모리 보완|주기억장치 접근속도 보완|
|분류|보조기억장치 사용 테크닉|실제 저장장치|
|용량|매우 크다|작다|
|제어주체|운영체제|하드웨어|
|속도|빠름|느림|
|매핑|가상주소와 물리주소|주기억장치의 데이터|
